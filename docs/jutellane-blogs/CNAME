      - name: Resolve SITE_URL (CNAME-aware)
        shell: pwsh
        run: |
          $default = "https://justine6.github.io/jutellane-blogs"
          $cname   = "docs/jutellane-blogs/CNAME"
          
                - name: Rewrite base URLs in metadata
        shell: pwsh
        run: |
          $site = $env:SITE_URL.TrimEnd('/')
          Write-Host "ðŸ”§ Rewriting base URLs to use $site"
          $targets = @(
            'feed.xml',
            'sitemap.xml',
            'posts.json',
            'tags/index.html',
            'tags/feed.xml'
          ) | Where-Object { Test-Path $_ }

          foreach ($file in $targets) {
            (Get-Content $file -Raw) -replace 'https://justine6.github.io/jutellane-blogs', $site |
              Set-Content -Encoding UTF8 $file
            Write-Host "âœ“ Updated: $file"
          }


          if (Test-Path $cname) {
            $domain = (Get-Content $cname | Select-Object -First 1).Trim()
            if ($domain) {
              $url = "https://$domain"   # With CNAME, Pages serves at the domain root
            }
          }

          if (-not $url) { $url = $default }
          "SITE_URL=$url" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
          Write-Host "Resolved SITE_URL: $url"
